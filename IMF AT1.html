<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme de Microfinance</title>
    <style>
  /* Styles généraux */
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f4f4f4;
}

.container {
  width: 80%;
  margin: 20px auto;
  background-color: #fff;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

h1,
h2 {
  text-align: center;
  margin-bottom: 20px;
}

/* Styles des onglets */
.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
  border-radius: 5px;
  display: flex; /* Aligne les boutons sur la même ligne */
  flex-wrap: wrap; /* Permet aux boutons de s'envelopper sur plusieurs lignes si nécessaire */
}

.tablinks {
  background-color: #4CAF50;
  color: white;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 10px 12px; /* Réduction du padding */
  transition: background-color 0.3s;
  font-size: 14px; /* Réduction de la taille de la police */
  margin-bottom: 10px; 
  flex: 1 0 45%; /* Chaque bouton prend 45% de la largeur, minimum 45% */
}

.tablinks:hover {
  background-color: #45a049;
}

.tablinks.active {
  background-color: #45a049;
}

.tabcontent {
  display: none;
  padding: 20px;
  border-top: none;
}

/* Styles des formulaires */
form {
  margin-top: 20px;
}

.form-field {
  margin-bottom: 10px;
}

label {
  display: block;
  margin-bottom: 5px;
}

/* Styles pour les champs de saisie */
input[type="text"],
input[type="date"],
input[type="number"],
select {
  width: 100%;
  padding: 10px;
  border: 2px solid black;
  border-radius: 5px;
  box-sizing: border-box;
}

/* Style des boutons d'enregistrement */
button[type="submit"] {
  background-color: #0000FF;
  color: #ffd700; /* Texte or */
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  font-size: 18px;
  display: block;
  margin: 0 auto;
  margin-bottom: 10px;
}

/* Styles du tableau des détails */
#detailsTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

#detailsTable th,
#detailsTable td {
  text-align: left;
  padding: 8px;
  border: 1px solid #ccc;
}

#detailsTable th {
  background-color: #f2f2f2;
}

#totalAdherentsOperations {
  margin-top: 20px;
  font-weight: bold;
}

/* Styles pour le conteneur du graphique */
#chart {
  width: 100%;
  height: 400px;
  margin-top: 20px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

/* Styles pour le formulaire d'adhérent */
#adherentForm {
  margin-top: 20px;
  background-color: #F9E892;
  padding: 20px;
  border-radius: 5px;
}

/* Styles pour le formulaire d'enregistrement des opérations */
#operationForm {
  margin-top: 20px;
  background-color: #F9E892;
  padding: 20px;
  border-radius: 5px;
}

/* Styles pour la barre de chargement */
.loading {
  display: none;
  width: 100%;
  height: 20px;
  background-color: #eee;
  border-radius: 5px;
  margin-top: 10px;
  overflow: hidden;
}

.bar {
  height: 100%;
  background-color: #4caf50;
  width: 0%;
  transition: width 0.5s ease-in-out;
}

/* Styles pour les analyses */
.analysis-section {
  margin-top: 20px;
}

/* Styles pour les champs en ligne */
.inline-fields .form-field {
  display: inline-block;
  width: 32%;
  margin-right: 1%;
}

/* Style spécifique pour le champ de fichier */
.inline-fields .form-field input[type="file"] {
  width: 90%;
}

/* Nouvelle règle pour supprimer les bordures */
.no-border input[type="file"] {
  border: none;
}

/* Styles pour le carrousel d'images */
#imageCarousel {
  width: 100%;
  overflow: hidden;
  margin-bottom: 20px;
}

#imageCarousel img {
  width: 100%;
  height: auto;
  display: none;
  border-radius: 10px;
}

#imageCarousel img.active {
  display: block;
}

/* Styles des boutons des détails */
#details .tablinks {
  background-color: #0000FF;
  color: #ffd700;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 10px 20px;
  transition: background-color 0.3s;
  font-size: 17px;
  display: inline-block;
  margin: 10px 5px;
  border-radius: 5px;
  font-weight: bold;
}

#details .tablinks:hover {
  background-color: #e6c300;
}

/* Styles pour les écrans de moins de 768 pixels de large */
@media (max-width: 768px) { 
  .container {
    width: 95%;
    padding: 10px; 
  }

  .tablinks {
    font-size: 14px;
    padding: 10px 12px; 
  }

  .inline-fields .form-field {
    display: block; 
    width: 100%; 
    margin-right: 0;
  }

  h2 {
    font-size: 1.5em; 
  }

  /* Raccourcir le texte du bouton "Tendances graphiques" */
  .tablinks[onclick="openTab(event, 'tendances')"] .long-text {
    display: none;
  }

  .tablinks[onclick="openTab(event, 'tendances')"] .short-text {
    display: inline;
  }
}
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>Application de Microfinance</h1>

        <div id="imageCarousel">
            <img src="https://firebasestorage.googleapis.com/v0/b/microfinance-68811.appspot.com/o/Image%20Accueil%2FImage%20IMF1.jpeg?alt=media&token=030dc305-b724-4a41-aca7-f0d345ab8bb2" alt="Image 1">
            <img src="https://firebasestorage.googleapis.com/v0/b/microfinance-68811.appspot.com/o/Image%20Accueil%2FImage%20IMF2.jpg?alt=media&token=3079599f-1df1-4ba1-b93b-b9a928b8d4be" alt="Image 2">
            <img src="https://firebasestorage.googleapis.com/v0/b/microfinance-68811.appspot.com/o/Image%20Accueil%2FImage%20IMF3.jpg?alt=media&token=5168ccfa-4e2d-4560-a312-26b6cf6ec03f" alt="Image 3">
            <img src="https://firebasestorage.googleapis.com/v0/b/microfinance-68811.appspot.com/o/Image%20Accueil%2FImage%20IMF4.jpg?alt=media&token=538ce237-86a8-40db-9a76-40fec275cf65" alt="Image 4">
        </div>

        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'adherents')">Enregistrement des Adhérents</button>
            <button class="tablinks" onclick="openTab(event, 'operations')">Enregistrement des opérations</button>
            <button class="tablinks" onclick="openTab(event, 'details')">Détails Généraux</button>
            <button class="tablinks" onclick="openTab(event, 'tendances')">
                <span class="long-text">Tendances graphiques</span>
                <span class="short-text">Graphiques</span>
            </button>
        </div>

        <div id="adherents" class="tabcontent">
            <h2>Enregistrement des Adhérents</h2>
            <form id="adherentForm">
                <div class="inline-fields">
                    <div class="form-field">
                        <label for="civilite">Civilité:</label>
                        <select id="civilite" required>
                            <option value="">Sélectionnez</option>
                            <option value="Monsieur">Monsieur</option>
                            <option value="Madame">Madame</option>
                            <option value="Mademoiselle">Mademoiselle</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="dateNaissance">Date de naissance:</label>
                        <input type="date" id="dateNaissance" required>
                    </div>
                    <div class="form-field">
                        <label for="lieuNaissance">Lieu de naissance:</label>
                        <input type="text" id="lieuNaissance" required>
                    </div>
                </div>
                <div class="form-field">
                    <label for="nom">Nom et Prénoms:</label>
                    <input type="text" id="nom" required>
                </div>

                <div class="inline-fields">
                    <div class="form-field">
                        <label for="adresse">Adresse:</label>
                        <input type="text" id="adresse" required>
                    </div>
                    <div class="form-field">
                        <label for="telephone">N° de Téléphone:</label>
                        <input type="text" id="telephone" required>
                    </div>
                    <div class="form-field">
                        <label for="situationMatrimoniale">Situation Matrimoniale:</label>
                        <select id="situationMatrimoniale" required>
                            <option value="">Sélectionnez</option>
                            <option value="Célibataire">Célibataire</option>
                            <option value="Marié(e)">Marié(e)</option>
                            <option value="Divorcé(e)">Divorcé(e)</option>
                            <option value="Veuf(ve)">Veuf(ve)</option>
                        </select>
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-field">
                        <label for="pieceIdentite">N° de Pièce d'Identité:</label>
                        <input type="text" id="pieceIdentite" required>
                    </div>
                    <div class="form-field no-border">
                        <label for="pieceIdentiteFile">Joindre une copie de la Pièce d'Identité:</label>
                        <input type="file" id="pieceIdentiteFile">
                    </div>
                </div>

                <h3>Informations de la Personne à Contacter</h3>
                <div class="form-field">
                    <label for="contactNom">Nom et Prénoms:</label>
                    <input type="text" id="contactNom" required>
                </div>
                <div class="inline-fields">
                    <div class="form-field">
                        <label for="contactAdresse">Adresse:</label>
                        <input type="text" id="contactAdresse" required>
                    </div>
                    <div class="form-field">
                        <label for="contactTelephone">N° de Téléphone:</label>
                        <input type="text" id="contactTelephone" required>
                    </div>
                    <div class="form-field">
                        <label for="contactPieceIdentite">N° de Pièce d'Identité:</label>
                        <input type="text" id="contactPieceIdentite" required>
                    </div>
                </div>
                <div class="form-field no-border"> 
                    <label for="contactPieceIdentiteFile">Joindre une copie de la Pièce d'Identité de la personne à contacter:</label> 
                    <input type="file" id="contactPieceIdentiteFile"> 
                </div>
                <div id="adherentLoading" class="loading">
                    <div class="bar"></div>
                </div>

                <button type="submit">Enregistrer l'adhérent</button>
            </form>
        </div>

        <div id="operations" class="tabcontent">
            <h2>Enregistrement des opérations</h2>
            <form id="operationForm">
                <div class="form-field">
                    <label for="typeOperation">Type d'opération:</label>
                    <select id="typeOperation" required>
                        <option value="">Sélectionnez</option>
                        <option value="mise">Mise</option>
                        <option value="pret">Prêt</option>
                        <option value="tontine">Tontine</option>
                        <option value="tontine">Frais d'Adhésion</option>
                        <option value="tontine">Retrait</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="adherent">Adhérent:</label>
                    <select id="adherent" required>
                        <!-- Les options seront remplies dynamiquement -->
                    </select>
                </div>
                <div class="form-field">
                    <label for="montant">Montant:</label>
                    <input type="number" id="montant" required>
                </div>
                <div class="form-field">
                    <label for="dateOperation">Date:</label>
                    <input type="date" id="dateOperation" required>
                </div>

                <div id="operationLoading" class="loading">
                    <div class="bar"></div>
                </div>

                <button type="submit">Enregistrer l'opération</button>
            </form>
        </div>

        <div id="details" class="tabcontent">
            <h2>Détails des adhérents</h2>
            <table id="detailsTable">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Total des mises</th>
                        <th>Total des prêts</th>
                        <th>Total des tontines</th>
                        <th>Total général</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Les lignes seront remplies dynamiquement -->
                </tbody>
            </table>
            <div id="totalAdherentsOperations">
                Total Général des Opérations : <span id="totalGeneralOperations">0</span> FCFA
            </div>

            <button class="tablinks" onclick="afficherDetailsGlobaux()">Détails Globaux</button>
            <button class="tablinks" onclick="afficherDetailsAnalyses()">Détails Analyse</button>

            <div id="detailsGlobaux" style="display: none;">
                <h2>Détails globaux</h2>
                <p>Total des mises : <span id="totalMises">0</span> FCFA</p>
                <p>Total des prêts : <span id="totalPrets">0</span> FCFA</p>
                <p>Total des tontines : <span id="totalTontines">0</span> FCFA</p>
                <p>Nombre d'adhérents : <span id="nombreAdherents">0</span></p>
                <p>Total général : <span id="totalGeneral">0</span> FCFA</p>
            </div>

            <div id="detailsAnalyses" style="display: none;">
                <h2>Analyses</h2>
                
                <div class="analysis-section">
                    <h3>Analyse Hebdomadaire</h3>
                    <p>Total des mises : <span id="totalMisesHebdomadaire">0</span> FCFA</p>
                    <p>Total des prêts : <span id="totalPretsHebdomadaire">0</span> FCFA</p>
                    <p>Total des tontines : <span id="totalTontinesHebdomadaire">0</span> FCFA</p>
                    <p>Total général : <span id="totalGeneralHebdomadaire">0</span> FCFA</p>
                </div>

                <div class="analysis-section">
                    <h3>Analyse Mensuelle</h3>
                    <p>Total des mises : <span id="totalMisesMensuelle">0</span> FCFA</p>
                    <p>Total des prêts : <span id="totalPretsMensuelle">0</span> FCFA</p>
                    <p>Total des tontines : <span id="totalTontinesMensuelle">0</span> FCFA</p>
                    <p>Total général : <span id="totalGeneralMensuelle">0</span> FCFA</p>
                </div>

                <div class="analysis-section">
                    <h3>Analyse Annuelle</h3>
                    <p>Total des mises : <span id="totalMisesAnnuelle">0</span> FCFA</p>
                    <p>Total des prêts : <span id="totalPretsAnnuelle">0</span> FCFA</p>
                    <p>Total des tontines : <span id="totalTontinesAnnuelle">0</span> FCFA</p>
                    <p>Total général : <span id="totalGeneralAnnuelle">0</span> FCFA</p>
                </div>
            </div>
        </div>

        <div id="tendances" class="tabcontent">
            <h2>Tendances graphiques</h2>
            <canvas id="myChart"></canvas>
        </div>

        <div id="analyses" class="tabcontent">
            <h2>Analyses</h2>

            <div class="analysis-section">
                <h3>Analyse Hebdomadaire</h3>
                <p>Total des mises : <span id="totalMisesHebdomadaire2">0</span> FCFA</p>
                <p>Total des prêts : <span id="totalPretsHebdomadaire2">0</span> FCFA</p>
                <p>Total des tontines : <span id="totalTontinesHebdomadaire2">0</span> FCFA</p>
                <p>Total général : <span id="totalGeneralHebdomadaire2">0</span> FCFA</p>
            </div>

            <div class="analysis-section">
                <h3>Analyse Mensuelle</h3>
                <p>Total des mises : <span id="totalMisesMensuelle2">0</span> FCFA</p>
                <p>Total des prêts : <span id="totalPretsMensuelle2">0</span> FCFA</p>
                <p>Total des tontines : <span id="totalTontinesMensuelle2">0</span> FCFA</p>
                <p>Total général : <span id="totalGeneralMensuelle2">0</span> FCFA</p>
            </div>

            <div class="analysis-section">
                <h3>Analyse Annuelle</h3>
                <p>Total des mises : <span id="totalMisesAnnuelle2">0</span> FCFA</p>
                <p>Total des prêts : <span id="totalPretsAnnuelle2">0</span> FCFA</p>
                <p>Total des tontines : <span id="totalTontinesAnnuelle2">0</span> FCFA</p>
                <p>Total général : <span id="totalGeneralAnnuelle2">0</span> FCFA</p>
            </div>
        </div>
    </div>

    <script>
      // Configuration de Firebase (remplacez par vos propres informations)
const firebaseConfig = {
    apiKey: "AIzaSyAn4gdgbPBESE1ry9140ngM-Av5hq0kAVQ",
  authDomain: "microfinance-68811.firebaseapp.com",
  databaseURL: "https://microfinance-68811-default-rtdb.firebaseio.com",
  projectId: "microfinance-68811",
  storageBucket: "microfinance-68811.appspot.com",
  messagingSenderId: "328514838296",
  appId: "1:328514838296:web:687b3fa630bcb51e52c86d",
  measurementId: "G-EMJRY7FV2K"
};

// Initialisation de Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const storage = firebase.storage();

// Fonction pour ouvrir un onglet
function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";

    if (tabName === 'details') {
        chargerDetailsAdherentsEtGlobaux();
    } else if (tabName === 'tendances') {
        chargerTendances();
    } else if (tabName === 'operations') {
        chargerListeAdherents();
    } else if (tabName === 'analyses') {
        afficherAnalyses();
    }
}

// Fonction pour afficher la barre de chargement
function showLoading(loadingId) {
    document.getElementById(loadingId).style.display = 'block';
}

// Fonction pour masquer la barre de chargement
function hideLoading(loadingId) {
    document.getElementById(loadingId).style.display = 'none';
}

// Fonction pour mettre à jour la largeur de la barre
function updateLoading(loadingId, width) {
    document.getElementById(loadingId).querySelector('.bar').style.width = width + '%';
}

// Enregistrement d'un adhérent
document.getElementById('adherentForm').addEventListener('submit', function (e) {
    e.preventDefault();
    showLoading('adherentLoading'); // Afficher la barre de chargement

    // Récupérer les informations de l'adhérent
    const adherent = {
        civilite: document.getElementById('civilite').value,
        nom: document.getElementById('nom').value,
        dateNaissance: document.getElementById('dateNaissance').value,
        lieuNaissance: document.getElementById('lieuNaissance').value,
        adresse: document.getElementById('adresse').value,
        telephone: document.getElementById('telephone').value,
        situationMatrimoniale: document.getElementById('situationMatrimoniale').value,
        pieceIdentite: document.getElementById('pieceIdentite').value,
        // Ajouter les informations de la personne à contacter
        contact: {
            nom: document.getElementById('contactNom').value,
            adresse: document.getElementById('contactAdresse').value,
            telephone: document.getElementById('contactTelephone').value,
            pieceIdentite: document.getElementById('contactPieceIdentite').value
        }
    };

    // Stocker les fichiers dans Firebase Storage
    const pieceIdentiteFile = document.getElementById('pieceIdentiteFile').files[0];
    const contactPieceIdentiteFile = document.getElementById('contactPieceIdentiteFile').files[0];

    let pieceIdentiteURL, contactPieceIdentiteURL;
    const storagePromises = [];

    if (pieceIdentiteFile) {
        const pieceIdentiteRef = storage.ref().child(`adherents/${adherent.nom}/piece_identite`);
        storagePromises.push(pieceIdentiteRef.put(pieceIdentiteFile).then(snapshot => snapshot.ref.getDownloadURL()));
    }

    if (contactPieceIdentiteFile) {
        const contactPieceIdentiteRef = storage.ref().child(`adherents/${adherent.nom}/contact_piece_identite`);
        storagePromises.push(contactPieceIdentiteRef.put(contactPieceIdentiteFile).then(snapshot => snapshot.ref.getDownloadURL()));
    }

    // Enregistrer l'adhérent dans la Realtime Database après avoir téléchargé les fichiers
    Promise.all(storagePromises)
        .then(urls => {
            // Ajouter les URL des fichiers à l'objet adhérent
            if (urls[0]) {
                adherent.pieceIdentiteURL = urls[0];
            }
            if (urls[1]) {
                adherent.contact.pieceIdentiteURL = urls[1];
            }

            // Enregistrer l'adhérent dans la Realtime Database
            const adherentsRef = database.ref('adherents');
            const newAdherentRef = adherentsRef.push(); // Créer un nouvel enfant (un nouvel adhérent)

            // Afficher le chemin de l'adhérent dans la console
            console.log("Chemin de l'adhérent:", newAdherentRef.key);

            // Mettre à jour la largeur de la barre de chargement
            updateLoading('adherentLoading', 20);
            setTimeout(() => updateLoading('adherentLoading', 50), 1000);
            setTimeout(() => updateLoading('adherentLoading', 80), 2000);
            setTimeout(() => {
                updateLoading('adherentLoading', 100); // Barre à 100%

                // Enregistrer les données de l'adhérent
                newAdherentRef.set(adherent)
                    .then(() => {
                        hideLoading('adherentLoading'); // Masquer la barre de chargement
                        alert('Adhérent enregistré avec succès!');
                        document.getElementById('adherentForm').reset();
                    })
                    .catch((error) => {
                        console.error("Erreur lors de l'enregistrement de l'adhérent: ", error);
                    });
            }, 3000);
        })
        .catch((error) => {
            console.error("Erreur lors du téléchargement des fichiers: ", error);
        });
});

// Enregistrement d'une opération
document.getElementById('operationForm').addEventListener('submit', function (e) {
    e.preventDefault();
    showLoading('operationLoading'); // Afficher la barre de chargement

    const operation = {
        type: document.getElementById('typeOperation').value,
        adherentId: document.getElementById('adherent').value,
        montant: parseFloat(document.getElementById('montant').value),
        date: document.getElementById('dateOperation').value
    };

    // Mettre à jour la largeur de la barre de chargement
    updateLoading('operationLoading', 20);
    setTimeout(() => updateLoading('operationLoading', 50), 1000);
    setTimeout(() => updateLoading('operationLoading', 80), 2000);
    setTimeout(() => {
        updateLoading('operationLoading', 100); // Barre à 100%

        // Enregistrer l'opération dans la Realtime Database
        const operationsRef = database.ref('operations');
        operationsRef.push(operation) // Enregistrer dans la Realtime Database
            .then(() => {
                hideLoading('operationLoading'); // Masquer la barre de chargement
                alert('Opération enregistrée avec succès!');
                document.getElementById('operationForm').reset();
            })
            .catch((error) => {
                console.error("Erreur lors de l'enregistrement de l'opération: ", error);
            });
    }, 3000);
});

// Charger les détails des adhérents et globaux (combinés)
function chargerDetailsAdherentsEtGlobaux() {
    const adherentsRef = database.ref('adherents');
    const operationsRef = database.ref('operations');

    adherentsRef.on('value', (adherentsSnapshot) => {
        const adherentsData = adherentsSnapshot.val();

        operationsRef.on('value', (operationsSnapshot) => {
            const operationsData = operationsSnapshot.val() || [];
            const detailsTable = document.getElementById('detailsTable').getElementsByTagName('tbody')[0];
            detailsTable.innerHTML = '';
            let totalGeneralOperations = 0;
            let totalMises = 0;
            let totalPrets = 0;
            let totalTontines = 0;

            for (const adherentKey in adherentsData) {
                const adherent = adherentsData[adherentKey];
                let totalMisesAdherent = 0;
                let totalPretsAdherent = 0;
                let totalTontinesAdherent = 0;

                for (const operationKey in operationsData) {
                    const operation = operationsData[operationKey];
                    if (operation.adherentId === adherent.nom) {
                        if (operation.type === 'mise') {
                            totalMisesAdherent += operation.montant;
                            totalMises += operation.montant;
                        } else if (operation.type === 'pret') {
                            totalPretsAdherent += operation.montant;
                            totalPrets += operation.montant;
                        } else if (operation.type === 'tontine') {
                            totalTontinesAdherent += operation.montant;
                            totalTontines += operation.montant;
                        }
                    }
                }

                const totalAdherent = totalMisesAdherent + totalPretsAdherent + totalTontinesAdherent;
                totalGeneralOperations += totalAdherent;

                const row = detailsTable.insertRow();
                row.innerHTML = `
                    <td>${adherent.nom}</td>
                    <td>${totalMisesAdherent} FCFA</td>
                    <td>${totalPretsAdherent} FCFA</td>
                    <td>${totalTontinesAdherent} FCFA</td>
                    <td>${totalAdherent} FCFA</td>
                `;
            }

            document.getElementById('totalGeneralOperations').textContent = totalGeneralOperations + " FCFA";
            document.getElementById('totalMises').textContent = totalMises + " FCFA";
            document.getElementById('totalPrets').textContent = totalPrets + " FCFA";
            document.getElementById('totalTontines').textContent = totalTontines + " FCFA";
            document.getElementById('totalGeneral').textContent = (totalMises + totalPrets + totalTontines) + " FCFA";
            document.getElementById('nombreAdherents').textContent = Object.keys(adherentsData).length;
        });
    });
}

// Charger les tendances (à implémenter avec une bibliothèque de graphiques)
function chargerTendances() {
    const operationsRef = database.ref('operations');

    operationsRef.on('value', (snapshot) => {
        const operations = snapshot.val() || [];
        const labels = []; // Tableau pour les dates des opérations
        const data = {
            mises: [],
            prets: [],
            tontines: []
        };

        for (const operationKey in operations) {
            const operation = operations[operationKey];
            labels.push(operation.date); // Ajouter la date au tableau des labels

            if (operation.type === 'mise') {
                data.mises.push(operation.montant);
            } else if (operation.type === 'pret') {
                data.prets.push(operation.montant);
            } else if (operation.type === 'tontine') {
                data.tontines.push(operation.montant);
            }
        }

        // Créer le graphique avec Chart.js
        const ctx = document.getElementById('myChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'line', // Type de graphique (ligne)
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Mises',
                        data: data.mises,
                        borderColor: 'blue',
                        borderWidth: 1
                    },
                    {
                        label: 'Prêts',
                        data: data.prets,
                        borderColor: 'red',
                        borderWidth: 1
                    },
                    {
                        label: 'Tontines',
                        data: data.tontines,
                        borderColor: 'green',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
}

// Charger la liste des adhérents pour le formulaire d'opérations
function chargerListeAdherents() {
    const adherentSelect = document.getElementById('adherent');
    adherentSelect.innerHTML = '<option value="">Sélectionnez un adhérent</option>';
    const adherentsRef = database.ref('adherents');

    adherentsRef.on('value', (snapshot) => {
        const adherentsData = snapshot.val();
        if (adherentsData) {
            for (const adherentKey in adherentsData) {
                const adherent = adherentsData[adherentKey];
                const option = document.createElement('option');
                option.value = adherent.nom; // Stocke le nom de l'adhérent comme valeur
                option.text = adherent.nom; // Affiche le nom dans la liste déroulante
                adherentSelect.appendChild(option);
            }
        }
    });
}

// Fonction pour obtenir la semaine actuelle (numéro de semaine ISO)
function getCurrentWeek() {
    const date = new Date();
    const onejan = new Date(date.getFullYear(), 0, 1);
    const weekNumber = Math.ceil((((date - onejan) / 86400000) + onejan.getDay() + 1) / 7);
    return weekNumber;
}

// Fonction pour obtenir le mois actuel (0 = janvier, 1 = février, etc.)
function getCurrentMonth() {
    const date = new Date();
    return date.getMonth();
}

// Fonction pour obtenir l'année actuelle
function getCurrentYear() {
    const date = new Date();
    return date.getFullYear();
}

// Fonction pour filtrer les opérations par semaine, mois ou année
function filterOperations(operations, period, value) {
    return operations.filter(operation => {
        const date = new Date(operation.date);
        if (period === 'week') {
            const currentWeek = getCurrentWeek();
            const operationWeek = getWeekNumber(date);
            return currentWeek === operationWeek;
        } else if (period === 'month') {
            return date.getMonth() === value;
        } else if (period === 'year') {
            return date.getFullYear() === value;
        }
        return false;
    });
}

// Fonction pour obtenir le numéro de semaine ISO d'une date
function getWeekNumber(date) {
    const onejan = new Date(date.getFullYear(), 0, 1);
    return Math.ceil((((date - onejan) / 86400000) + onejan.getDay() + 1) / 7);
}

// Fonction pour calculer les totaux par type d'opération
function calculateTotals(operations) {
    let totalMises = 0;
    let totalPrets = 0;
    let totalTontines = 0;

    operations.forEach(operation => {
        if (operation.type === 'mise') {
            totalMises += operation.montant;
        } else if (operation.type === 'pret') {
            totalPrets += operation.montant;
        } else if (operation.type === 'tontine') {
            totalTontines += operation.montant;
        }
    });

    return { totalMises, totalPrets, totalTontines };
}

// Fonction pour afficher les analyses
function afficherAnalyses() {
    const operationsRef = database.ref('operations');

    operationsRef.on('value', (snapshot) => {
        const operations = snapshot.val() || [];

        // Analyse hebdomadaire
        const operationsHebdomadaire = filterOperations(operations, 'week', getCurrentWeek());
        const totauxHebdomadaire = calculateTotals(operationsHebdomadaire);
        document.getElementById('totalMisesHebdomadaire').textContent = totauxHebdomadaire.totalMises + " FCFA";
        document.getElementById('totalPretsHebdomadaire').textContent = totauxHebdomadaire.totalPrets + " FCFA";
        document.getElementById('totalTontinesHebdomadaire').textContent = totauxHebdomadaire.totalTontines + " FCFA";
        document.getElementById('totalGeneralHebdomadaire').textContent = (totauxHebdomadaire.totalMises + totauxHebdomadaire.totalPrets + totauxHebdomadaire.totalTontines) + " FCFA";
        document.getElementById('totalMisesHebdomadaire2').textContent = totauxHebdomadaire.totalMises + " FCFA";
        document.getElementById('totalPretsHebdomadaire2').textContent = totauxHebdomadaire.totalPrets + " FCFA";
        document.getElementById('totalTontinesHebdomadaire2').textContent = totauxHebdomadaire.totalTontines + " FCFA";
        document.getElementById('totalGeneralHebdomadaire2').textContent = (totauxHebdomadaire.totalMises + totauxHebdomadaire.totalPrets + totauxHebdomadaire.totalTontines) + " FCFA";


        // Analyse mensuelle
        const operationsMensuelle = filterOperations(operations, 'month', getCurrentMonth());
        const totauxMensuelle = calculateTotals(operationsMensuelle);
        document.getElementById('totalMisesMensuelle').textContent = totauxMensuelle.totalMises + " FCFA";
        document.getElementById('totalPretsMensuelle').textContent = totauxMensuelle.totalPrets + " FCFA";
        document.getElementById('totalTontinesMensuelle').textContent = totauxMensuelle.totalTontines + " FCFA";
        document.getElementById('totalGeneralMensuelle').textContent = (totauxMensuelle.totalMises + totauxMensuelle.totalPrets + totauxMensuelle.totalTontines) + " FCFA";
        document.getElementById('totalMisesMensuelle2').textContent = totauxMensuelle.totalMises + " FCFA";
        document.getElementById('totalPretsMensuelle2').textContent = totauxMensuelle.totalPrets + " FCFA";
        document.getElementById('totalTontinesMensuelle2').textContent = totauxMensuelle.totalTontines + " FCFA";
        document.getElementById('totalGeneralMensuelle2').textContent = (totauxMensuelle.totalMises + totauxMensuelle.totalPrets + totauxMensuelle.totalTontines) + " FCFA";

        // Analyse annuelle
        const operationsAnnuelle = filterOperations(operations, 'year', getCurrentYear());
        const totauxAnnuelle = calculateTotals(operationsAnnuelle);
        document.getElementById('totalMisesAnnuelle').textContent = totauxAnnuelle.totalMises + " FCFA";
        document.getElementById('totalPretsAnnuelle').textContent = totauxAnnuelle.totalPrets + " FCFA";
        document.getElementById('totalTontinesAnnuelle').textContent = totauxAnnuelle.totalTontines + " FCFA";
        document.getElementById('totalGeneralAnnuelle').textContent = (totauxAnnuelle.totalMises + totauxAnnuelle.totalPrets + totauxAnnuelle.totalTontines) + " FCFA";
        document.getElementById('totalMisesAnnuelle2').textContent = totauxAnnuelle.totalMises + " FCFA";
        document.getElementById('totalPretsAnnuelle2').textContent = totauxAnnuelle.totalPrets + " FCFA";
        document.getElementById('totalTontinesAnnuelle2').textContent = totauxAnnuelle.totalTontines + " FCFA";
        document.getElementById('totalGeneralAnnuelle2').textContent = (totauxAnnuelle.totalMises + totauxAnnuelle.totalPrets + totauxAnnuelle.totalTontines) + " FCFA";
    });
}

// Fonction pour récupérer les images de Firebase Storage et les afficher dans le carrousel
function afficherImages() {
    const storageRef = firebase.storage().ref();
    const imagesRef = storageRef.child('Image Accueil'); // Remplacez 'images' par le chemin de votre dossier d'images dans Firebase Storage

    imagesRef.listAll().then(res => {
        let loadedImages = 0; // Compteur d'images chargées

        res.items.forEach(itemRef => {
            itemRef.getDownloadURL().then(url => {
                // Créer une image pour chaque URL
                const img = document.createElement('img');
                img.src = url;
                img.alt = "Image from Firebase Storage"; // Ajouter un attribut alt
                document.getElementById('imageCarousel').appendChild(img);

                // Incrémenter le compteur d'images chargées
                loadedImages++;

                // Démarrer le carrousel une fois toutes les URLs récupérées
                if (loadedImages === res.items.length) {
                    demarrerCarousel();
                }
            });
        });
    }).catch(error => {
        console.error("Erreur lors de la récupération des images:", error);
    });
}

// Fonction pour démarrer le carrousel d'images
function demarrerCarousel() {
    let currentImageIndex = 0;
    const images = document.querySelectorAll('#imageCarousel img');
    images[0].classList.add('active'); // Afficher la première image initialement

    setInterval(() => {
        // Masquer l'image actuelle
        images[currentImageIndex].classList.remove('active');

        // Passer à l'image suivante
        currentImageIndex = (currentImageIndex + 1) % images.length;

        // Afficher la nouvelle image
        images[currentImageIndex].classList.add('active');
    }, 5000); // Changer d'image toutes les 5 secondes (5000 millisecondes)
}

// Appeler la fonction pour afficher les images après le chargement de la page
document.addEventListener('DOMContentLoaded', (event) => {
    openTab({ currentTarget: document.querySelector('.tablinks') }, 'adherents');
    afficherImages();
});

function afficherDetailsGlobaux() {
    document.getElementById('detailsGlobaux').style.display = 'block';
    document.getElementById('detailsAnalyses').style.display = 'none';
}

function afficherDetailsAnalyses() {
    document.getElementById('detailsGlobaux').style.display = 'none';
    document.getElementById('detailsAnalyses').style.display = 'block';
}
    </script>
</body>
</html>